{"version":3,"names":["_NativeReanimated","require","_commonTypes","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","JSReanimated","NativeReanimated","constructor","Map","makeShareableClone","__hostObjectShareableJSRef","installCoreFunctions","_callGuard","_valueUnpacker","scheduleOnUI","worklet","requestAnimationFrame","registerEventHandler","_eventHash","_eventHandler","unregisterEventHandler","_","enableLayoutAnimations","console","warn","configureLayoutAnimation","registerSensor","sensorType","interval","iosReferenceFrame","eventHandler","getSensorName","window","sensor","initializeSensor","callback","SensorType","ROTATION","qw","qx","qy","qz","quaternion","yaw","Math","atan2","pitch","sin","roll","interfaceOrientation","x","y","z","addEventListener","start","sensors","set","nextSensorId","unregisterSensor","id","get","stop","delete","subscribeForKeyboardEvents","unsubscribeFromKeyboardEvents","config","referenceFrame","frequency","ACCELEROMETER","Accelerometer","GYROSCOPE","Gyroscope","GRAVITY","GravitySensor","MAGNETIC_FIELD","Magnetometer","AbsoluteOrientationSensor","exports","default"],"sources":["JSReanimated.ts"],"sourcesContent":["import { NativeReanimated } from '../NativeReanimated/NativeReanimated';\nimport {\n  SensorType,\n  ShareableRef,\n  Value3D,\n  ValueRotation,\n} from '../commonTypes';\nimport { WebSensor } from './WebSensor';\n\nexport default class JSReanimated extends NativeReanimated {\n  nextSensorId = 0;\n  sensors = new Map<number, WebSensor>();\n\n  constructor() {\n    super(false);\n  }\n\n  makeShareableClone<T>(value: T): ShareableRef<T> {\n    return { __hostObjectShareableJSRef: value };\n  }\n\n  installCoreFunctions(\n    _callGuard: <T extends Array<any>, U>(\n      fn: (...args: T) => U,\n      ...args: T\n    ) => void,\n    _valueUnpacker: <T>(value: T) => T\n  ): void {\n    // noop\n  }\n\n  scheduleOnUI<T>(worklet: ShareableRef<T>) {\n    // @ts-ignore web implementation has still not been updated after the rewrite, this will be addressed once the web implementation updates are ready\n    requestAnimationFrame(worklet);\n  }\n\n  registerEventHandler<T>(\n    _eventHash: string,\n    _eventHandler: ShareableRef<T>\n  ): string {\n    // noop\n    return '';\n  }\n\n  unregisterEventHandler(_: string): void {\n    // noop\n  }\n\n  enableLayoutAnimations() {\n    console.warn(\n      '[Reanimated] Layout Animations are not supported on web yet.'\n    );\n  }\n\n  configureLayoutAnimation() {\n    // no-op\n  }\n\n  registerSensor(\n    sensorType: SensorType,\n    interval: number,\n    iosReferenceFrame: number,\n    eventHandler: (data: Value3D | ValueRotation) => void\n  ): number {\n    if (!(this.getSensorName(sensorType) in window)) {\n      return -1;\n    }\n\n    const sensor: WebSensor = this.initializeSensor(sensorType, interval);\n    let callback;\n    if (sensorType === SensorType.ROTATION) {\n      callback = () => {\n        const [qw, qx, qy, qz] = sensor.quaternion;\n\n        // reference: https://stackoverflow.com/questions/5782658/extracting-yaw-from-a-quaternion\n        const yaw = Math.atan2(\n          2.0 * (qy * qz + qw * qx),\n          qw * qw - qx * qx - qy * qy + qz * qz\n        );\n        const pitch = Math.sin(-2.0 * (qx * qz - qw * qy));\n        const roll = Math.atan2(\n          2.0 * (qx * qy + qw * qz),\n          qw * qw + qx * qx - qy * qy - qz * qz\n        );\n        eventHandler({\n          qw,\n          qx,\n          qy,\n          qz,\n          yaw,\n          pitch,\n          roll,\n          interfaceOrientation: 0,\n        });\n      };\n    } else {\n      callback = () => {\n        const { x, y, z } = sensor;\n        eventHandler({ x, y, z, interfaceOrientation: 0 });\n      };\n    }\n    sensor.addEventListener('reading', callback);\n    sensor.start();\n\n    this.sensors.set(this.nextSensorId, sensor);\n    return this.nextSensorId++;\n  }\n\n  unregisterSensor(id: number): void {\n    const sensor: WebSensor | undefined = this.sensors.get(id);\n    if (sensor !== undefined) {\n      sensor.stop();\n      this.sensors.delete(id);\n    }\n  }\n\n  subscribeForKeyboardEvents(_: ShareableRef<number>): number {\n    console.warn(\n      '[Reanimated] useAnimatedKeyboard is not available on web yet.'\n    );\n    return -1;\n  }\n\n  unsubscribeFromKeyboardEvents(_: number): void {\n    // noop\n  }\n\n  initializeSensor(sensorType: SensorType, interval: number): WebSensor {\n    const config =\n      interval <= 0\n        ? { referenceFrame: 'device' }\n        : { frequency: 1000 / interval };\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return new window.Accelerometer(config);\n      case SensorType.GYROSCOPE:\n        return new window.Gyroscope(config);\n      case SensorType.GRAVITY:\n        return new window.GravitySensor(config);\n      case SensorType.MAGNETIC_FIELD:\n        return new window.Magnetometer(config);\n      case SensorType.ROTATION:\n        return new window.AbsoluteOrientationSensor(config);\n    }\n  }\n\n  getSensorName(sensorType: SensorType): string {\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return 'Accelerometer';\n      case SensorType.GRAVITY:\n        return 'GravitySensor';\n      case SensorType.GYROSCOPE:\n        return 'Gyroscope';\n      case SensorType.MAGNETIC_FIELD:\n        return 'Magnetometer';\n      case SensorType.ROTATION:\n        return 'AbsoluteOrientationSensor';\n    }\n  }\n}\n"],"mappings":"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"}