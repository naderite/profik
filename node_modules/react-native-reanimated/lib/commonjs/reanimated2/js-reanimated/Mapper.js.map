{"version":3,"names":["_PlatformChecker","require","_MutableValue","_interopRequireDefault","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","Mapper","constructor","module","mapper","inputs","arguments","length","outputs","id","MAPPER_ID","extractMutablesFromArray","markDirty","dirty","maybeRequestRender","forEach","addListener","execute","array","extractMutables","MutableValue","push","Array","isArray","v","isWebDomElement","keys","exports","shouldBeUseWeb","isWebNode","o","Node","nodeType","nodeName","isWebElement","HTMLElement"],"sources":["Mapper.ts"],"sourcesContent":["import { NestedObjectValues } from '../commonTypes';\nimport { shouldBeUseWeb } from '../PlatformChecker';\nimport { JSReanimated } from './commonTypes';\nimport MutableValue from './MutableValue';\n\nexport default class Mapper<T> {\n  static MAPPER_ID = 1;\n  id: number;\n  inputs: MutableValue<T>[];\n  outputs: MutableValue<T>[];\n  mapper: () => void;\n\n  dirty = true;\n\n  constructor(\n    module: JSReanimated,\n    mapper: () => void,\n    inputs: NestedObjectValues<MutableValue<T>>[] = [],\n    outputs: NestedObjectValues<MutableValue<T>>[] = []\n  ) {\n    this.id = Mapper.MAPPER_ID++;\n    this.inputs = this.extractMutablesFromArray(inputs);\n    this.outputs = this.extractMutablesFromArray(outputs);\n    this.mapper = mapper;\n\n    const markDirty = () => {\n      this.dirty = true;\n      module.maybeRequestRender();\n    };\n\n    this.inputs.forEach((input) => {\n      input.addListener(markDirty);\n    });\n  }\n\n  execute(): void {\n    this.dirty = false;\n    this.mapper();\n  }\n\n  extractMutablesFromArray<T>(\n    array: NestedObjectValues<MutableValue<T>>\n  ): MutableValue<T>[] {\n    const res: MutableValue<T>[] = [];\n\n    function extractMutables(value: NestedObjectValues<MutableValue<T>>) {\n      if (value == null) {\n        // return;\n      } else if (value instanceof MutableValue) {\n        res.push(value);\n      } else if (Array.isArray(value)) {\n        value.forEach((v) => extractMutables(v));\n      } else if (isWebDomElement(value)) {\n        // do nothing on dom elements\n        // without this check, we get a \"Maximum call size exceeded error\"\n      } else if (typeof value === 'object') {\n        Object.keys(value).forEach((key) => {\n          extractMutables(value[key]);\n        });\n      }\n    }\n\n    extractMutables(array);\n    return res;\n  }\n}\n\nfunction isWebDomElement(value: any) {\n  if (!shouldBeUseWeb()) {\n    return false;\n  }\n\n  // https://stackoverflow.com/a/384380/7869175\n  function isWebNode(o: any) {\n    return typeof Node === 'object'\n      ? o instanceof Node\n      : o &&\n          typeof o === 'object' &&\n          typeof o.nodeType === 'number' &&\n          typeof o.nodeName === 'string';\n  }\n\n  function isWebElement(o: any) {\n    return typeof HTMLElement === 'object'\n      ? o instanceof HTMLElement // DOM2\n      : o &&\n          typeof o === 'object' &&\n          o !== null &&\n          o.nodeType === 1 &&\n          typeof o.nodeName === 'string';\n  }\n\n  return isWebNode(value) || isWebElement(value);\n}\n"],"mappings":"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"}