{"version":3,"names":["_react","_interopRequireDefault","require","_reactNative","_WorkletEventHandler","_setAndForwardRef","_invariant","_ConfigHelper","_RNRenderer","_core","_PlatformChecker","_animation","_layoutReanimation","_ViewDescriptorsSet","_fabricUtils","_UpdateProps","_NativeReanimated","_reanimated","obj","__esModule","default","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_defineProperty","value","_toPropertyKey","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","dummyListener","maybeBuild","layoutAnimationOrBuilder","isAnimationBuilder","build","flattenArray","array","Array","isArray","resultArr","_flattenArray","arr","forEach","item","push","onlyAnimatedStyles","styles","filter","style","viewDescriptors","isSameAnimatedStyle","style1","style2","viewsRef","isSameAnimatedProps","has","x","isInlineStyleTransform","transform","some","t","hasInlineStyles","keys","styleValue","isSharedValue","extractSharedValuesMapFromProps","props","inlineProps","entries","inlinePropsHasChanged","styles1","styles2","getInlinePropsUpdate","update","map","createAnimatedComponent","Component","options","invariant","isReactComponent","name","AnimatedComponent","React","constructor","setAndForwardRef","getForwardedRef","forwardedRef","setLocalRef","ref","tag","findNodeHandle","layout","entering","exiting","sharedTransitionTag","shouldBeUseWeb","enableLayoutAnimations","configureLayoutAnimations","LayoutAnimationType","LAYOUT","ENTERING","EXITING","sharedElementTransition","sharedTransitionStyle","DefaultSharedTransition","SHARED_ELEMENT_TRANSITION","_component","isJest","animatedStyle","componentWillUnmount","_detachNativeEvents","_detachStyles","_detachInlineProps","componentDidMount","_attachNativeEvents","_attachAnimatedStyles","_attachInlineProps","_getEventViewRef","_this$_component","getScrollableNode","node","viewTag","setNativeProps","prop","current","WorkletEventHandler","registerForEvents","unregisterFromEvents","Platform","OS","_styles","remove","_viewTag","_this$props$animatedP","animatedProps","global","_IS_FABRIC","runOnUI","_removeShadowNodeFromRegistry","_reattachNativeEvents","prevProps","reattachNeeded","_updateFromNative","_this$_component2","_this$_component2$set","_getViewInfo","viewName","shadowNodeWrapper","viewConfig","_hostInstance$viewCon","hostInstance","RNRenderer","findHostInstance_DEPRECATED","Error","_nativeTag","uiViewClassName","getShadowNodeWrapperFromRef","_this$props$animatedP2","_this$props$animatedP3","prevStyles","prevAnimatedProps","_animatedProps","hasReanimated2Props","adaptViewConfig","hasOneSameStyle","prevStyle","isPresent","add","initial","newInlineProps","hasChanged","_inlineProps","_inlinePropsViewDescriptors","makeViewDescriptorsSet","sharableViewDescriptors","maybeViewRef","NativeReanimatedModule","native","items","Set","updaterFunction","updateProps","_inlinePropsMapperId","stopMapper","startMapper","values","componentDidUpdate","_filterNonAnimatedProps","inputProps","styleProp","processedStyle","_isFirstRender","initialStyle","initialUpdaterRun","updater","newStyle","StyleSheet","flatten","animatedProp","_animatedProp$initial","_animatedProp$viewsRe","eventNames","eventName","listeners","isChromeDebugger","render","platformProps","select","web","collapsable","createElement","_setComponentRef","displayName","forwardRef"],"sources":["createAnimatedComponent.tsx"],"sourcesContent":["import React, { Component, ComponentType, MutableRefObject, Ref } from 'react';\nimport { findNodeHandle, Platform, StyleSheet } from 'react-native';\nimport WorkletEventHandler from './reanimated2/WorkletEventHandler';\nimport setAndForwardRef from './setAndForwardRef';\nimport './reanimated2/layoutReanimation/animationsManager';\nimport invariant from 'invariant';\nimport { adaptViewConfig } from './ConfigHelper';\nimport { RNRenderer } from './reanimated2/platform-specific/RNRenderer';\nimport {\n  configureLayoutAnimations,\n  enableLayoutAnimations,\n  runOnUI,\n  startMapper,\n  stopMapper,\n} from './reanimated2/core';\nimport {\n  isJest,\n  isChromeDebugger,\n  shouldBeUseWeb,\n} from './reanimated2/PlatformChecker';\nimport { initialUpdaterRun } from './reanimated2/animation';\nimport {\n  BaseAnimationBuilder,\n  DefaultSharedTransition,\n  EntryExitAnimationFunction,\n  ILayoutAnimationBuilder,\n  LayoutAnimationFunction,\n  LayoutAnimationType,\n} from './reanimated2/layoutReanimation';\nimport {\n  SharedValue,\n  StyleProps,\n  ShadowNodeWrapper,\n} from './reanimated2/commonTypes';\nimport {\n  makeViewDescriptorsSet,\n  ViewDescriptorsSet,\n  ViewRefSet,\n} from './reanimated2/ViewDescriptorsSet';\nimport { getShadowNodeWrapperFromRef } from './reanimated2/fabricUtils';\nimport updateProps from './reanimated2/UpdateProps';\nimport NativeReanimatedModule from './reanimated2/NativeReanimated';\nimport { isSharedValue } from './reanimated2';\n\nfunction dummyListener() {\n  // empty listener we use to assign to listener properties for which animated\n  // event is used.\n}\n\nfunction maybeBuild(\n  layoutAnimationOrBuilder:\n    | ILayoutAnimationBuilder\n    | LayoutAnimationFunction\n    | Keyframe\n): LayoutAnimationFunction | Keyframe {\n  const isAnimationBuilder = (\n    value: ILayoutAnimationBuilder | LayoutAnimationFunction | Keyframe\n  ): value is ILayoutAnimationBuilder =>\n    'build' in layoutAnimationOrBuilder &&\n    typeof layoutAnimationOrBuilder.build === 'function';\n\n  if (isAnimationBuilder(layoutAnimationOrBuilder)) {\n    return layoutAnimationOrBuilder.build();\n  } else {\n    return layoutAnimationOrBuilder;\n  }\n}\n\ntype NestedArray<T> = T | NestedArray<T>[];\nfunction flattenArray<T>(array: NestedArray<T>): T[] {\n  if (!Array.isArray(array)) {\n    return [array];\n  }\n  const resultArr: T[] = [];\n\n  const _flattenArray = (arr: NestedArray<T>[]): void => {\n    arr.forEach((item) => {\n      if (Array.isArray(item)) {\n        _flattenArray(item);\n      } else {\n        resultArr.push(item);\n      }\n    });\n  };\n  _flattenArray(array);\n  return resultArr;\n}\n\nfunction onlyAnimatedStyles(styles: StyleProps[]) {\n  return styles.filter((style) => style?.viewDescriptors);\n}\n\nfunction isSameAnimatedStyle(\n  style1?: StyleProps,\n  style2?: StyleProps\n): boolean {\n  // We cannot use equality check to compare useAnimatedStyle outputs directly.\n  // Instead, we can compare its viewsRefs.\n  return style1?.viewsRef === style2?.viewsRef;\n}\n\nconst isSameAnimatedProps = isSameAnimatedStyle;\n\nconst has = <K extends string>(\n  key: K,\n  x: unknown\n): x is { [key in K]: unknown } => {\n  if (typeof x === 'function' || typeof x === 'object') {\n    if (x === null || x === undefined) {\n      return false;\n    } else {\n      return key in x;\n    }\n  }\n  return false;\n};\n\nfunction isInlineStyleTransform(transform: any): boolean {\n  if (!transform) {\n    return false;\n  }\n  return transform.some((t: Record<string, any>) => hasInlineStyles(t));\n}\n\nfunction hasInlineStyles(style: StyleProps): boolean {\n  if (!style) {\n    return false;\n  }\n  return Object.keys(style).some((key) => {\n    const styleValue = style[key];\n    return (\n      isSharedValue(styleValue) ||\n      (key === 'transform' && isInlineStyleTransform(styleValue))\n    );\n  });\n}\n\nfunction extractSharedValuesMapFromProps(\n  props: AnimatedComponentProps<InitialComponentProps>\n): Record<string, any> {\n  const inlineProps: Record<string, any> = {};\n\n  for (const key in props) {\n    const value = props[key];\n    if (key === 'style') {\n      const styles = flattenArray<StyleProps>(props.style ?? []);\n      styles.forEach((style) => {\n        if (!style) {\n          return;\n        }\n        for (const [key, styleValue] of Object.entries(style)) {\n          if (isSharedValue(styleValue)) {\n            inlineProps[key] = styleValue;\n          } else if (\n            key === 'transform' &&\n            isInlineStyleTransform(styleValue)\n          ) {\n            inlineProps[key] = styleValue;\n          }\n        }\n      });\n    } else if (isSharedValue(value)) {\n      inlineProps[key] = value;\n    }\n  }\n\n  return inlineProps;\n}\n\nfunction inlinePropsHasChanged(styles1: StyleProps, styles2: StyleProps) {\n  if (Object.keys(styles1).length !== Object.keys(styles2).length) {\n    return true;\n  }\n\n  for (const key of Object.keys(styles1)) {\n    if (styles1[key] !== styles2[key]) return true;\n  }\n\n  return false;\n}\n\nfunction getInlinePropsUpdate(inlineProps: Record<string, any>) {\n  'worklet';\n  const update: Record<string, any> = {};\n  for (const [key, styleValue] of Object.entries(inlineProps)) {\n    if (key === 'transform') {\n      update[key] = styleValue.map((transform: Record<string, any>) => {\n        return getInlinePropsUpdate(transform);\n      });\n    } else if (isSharedValue(styleValue)) {\n      update[key] = styleValue.value;\n    } else {\n      update[key] = styleValue;\n    }\n  }\n  return update;\n}\n\ninterface AnimatedProps extends Record<string, unknown> {\n  viewDescriptors?: ViewDescriptorsSet;\n  viewsRef?: ViewRefSet<unknown>;\n  initial?: SharedValue<StyleProps>;\n}\n\nexport type AnimatedComponentProps<P extends Record<string, unknown>> = P & {\n  forwardedRef?: Ref<Component>;\n  style?: NestedArray<StyleProps>;\n  animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n  animatedStyle?: StyleProps;\n  layout?:\n    | BaseAnimationBuilder\n    | ILayoutAnimationBuilder\n    | typeof BaseAnimationBuilder;\n  entering?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n  exiting?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n  sharedTransitionTag?: string;\n  sharedTransitionStyle?: ILayoutAnimationBuilder;\n};\n\ntype Options<P> = {\n  setNativeProps: (ref: ComponentRef, props: P) => void;\n};\n\ninterface ComponentRef extends Component {\n  setNativeProps?: (props: Record<string, unknown>) => void;\n  getScrollableNode?: () => ComponentRef;\n}\n\nexport interface InitialComponentProps extends Record<string, unknown> {\n  ref?: Ref<Component>;\n  collapsable?: boolean;\n}\n\nexport default function createAnimatedComponent(\n  Component: ComponentType<InitialComponentProps>,\n  options?: Options<InitialComponentProps>\n): ComponentType<AnimatedComponentProps<InitialComponentProps>> {\n  invariant(\n    typeof Component !== 'function' ||\n      (Component.prototype && Component.prototype.isReactComponent),\n    `Looks like you're passing a function component \\`${Component.name}\\` to \\`createAnimatedComponent\\` function which supports only class components. Please wrap your function component with \\`React.forwardRef()\\` or use a class component instead.`\n  );\n\n  class AnimatedComponent extends React.Component<\n    AnimatedComponentProps<InitialComponentProps>\n  > {\n    _styles: StyleProps[] | null = null;\n    _animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n    _viewTag = -1;\n    _isFirstRender = true;\n    animatedStyle: { value: StyleProps } = { value: {} };\n    initialStyle = {};\n    _component: ComponentRef | null = null;\n    _inlinePropsViewDescriptors: ViewDescriptorsSet | null = null;\n    _inlinePropsMapperId: number | null = null;\n    _inlineProps: StyleProps = {};\n    static displayName: string;\n\n    constructor(props: AnimatedComponentProps<InitialComponentProps>) {\n      super(props);\n      if (isJest()) {\n        this.animatedStyle = { value: {} };\n      }\n    }\n\n    componentWillUnmount() {\n      this._detachNativeEvents();\n      this._detachStyles();\n      this._detachInlineProps();\n    }\n\n    componentDidMount() {\n      this._attachNativeEvents();\n      this._attachAnimatedStyles();\n      this._attachInlineProps();\n    }\n\n    _getEventViewRef() {\n      // Make sure to get the scrollable node for components that implement\n      // `ScrollResponder.Mixin`.\n      return this._component?.getScrollableNode\n        ? this._component.getScrollableNode()\n        : this._component;\n    }\n\n    _attachNativeEvents() {\n      const node = this._getEventViewRef();\n      const viewTag = findNodeHandle(options?.setNativeProps ? this : node);\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.registerForEvents(viewTag as number, key);\n        }\n      }\n    }\n\n    _detachNativeEvents() {\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n    }\n\n    _detachStyles() {\n      if (Platform.OS === 'web' && this._styles !== null) {\n        for (const style of this._styles) {\n          if (style?.viewsRef) {\n            style.viewsRef.remove(this);\n          }\n        }\n      } else if (this._viewTag !== -1 && this._styles !== null) {\n        for (const style of this._styles) {\n          style.viewDescriptors.remove(this._viewTag);\n        }\n        if (this.props.animatedProps?.viewDescriptors) {\n          this.props.animatedProps.viewDescriptors.remove(this._viewTag);\n        }\n        if (global._IS_FABRIC) {\n          const viewTag = this._viewTag;\n          runOnUI(() => {\n            'worklet';\n            _removeShadowNodeFromRegistry!(viewTag);\n          })();\n        }\n      }\n    }\n\n    _reattachNativeEvents(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      let viewTag: number | undefined;\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          if (viewTag === undefined) {\n            viewTag = prop.current.viewTag;\n          }\n        }\n      }\n      for (const key in prevProps) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          prop.current.registerForEvents(viewTag!, key);\n          prop.current.reattachNeeded = false;\n        }\n      }\n    }\n\n    _updateFromNative(props: StyleProps) {\n      if (options?.setNativeProps) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        options.setNativeProps(this._component!, props);\n      } else {\n        // eslint-disable-next-line no-unused-expressions\n        this._component?.setNativeProps?.(props);\n      }\n    }\n\n    _getViewInfo() {\n      let viewTag: number | null;\n      let viewName: string | null;\n      let shadowNodeWrapper: ShadowNodeWrapper | null = null;\n      let viewConfig;\n      if (Platform.OS === 'web') {\n        viewTag = findNodeHandle(this);\n        viewName = null;\n        shadowNodeWrapper = null;\n        viewConfig = null;\n      } else {\n        // hostInstance can be null for a component that doesn't render anything (render function returns null). Example: svg Stop: https://github.com/react-native-svg/react-native-svg/blob/develop/src/elements/Stop.tsx\n        const hostInstance = RNRenderer.findHostInstance_DEPRECATED(this);\n        if (!hostInstance) {\n          throw new Error(\n            'Cannot find host instance for this component. Maybe it renders nothing?'\n          );\n        }\n        // we can access view tag in the same way it's accessed here https://github.com/facebook/react/blob/e3f4eb7272d4ca0ee49f27577156b57eeb07cf73/packages/react-native-renderer/src/ReactFabric.js#L146\n        viewTag = hostInstance?._nativeTag;\n        /**\n         * RN uses viewConfig for components for storing different properties of the component(example: https://github.com/facebook/react-native/blob/master/Libraries/Components/ScrollView/ScrollViewViewConfig.js#L16).\n         * The name we're looking for is in the field named uiViewClassName.\n         */\n        viewName = hostInstance?.viewConfig?.uiViewClassName;\n\n        viewConfig = hostInstance?.viewConfig;\n\n        if (global._IS_FABRIC) {\n          shadowNodeWrapper = getShadowNodeWrapperFromRef(this);\n        }\n      }\n      return { viewTag, viewName, shadowNodeWrapper, viewConfig };\n    }\n\n    _attachAnimatedStyles() {\n      const styles = this.props.style\n        ? onlyAnimatedStyles(flattenArray<StyleProps>(this.props.style))\n        : [];\n      const prevStyles = this._styles;\n      this._styles = styles;\n\n      const prevAnimatedProps = this._animatedProps;\n      this._animatedProps = this.props.animatedProps;\n\n      const { viewTag, viewName, shadowNodeWrapper, viewConfig } =\n        this._getViewInfo();\n\n      // update UI props whitelist for this view\n      const hasReanimated2Props =\n        this.props.animatedProps?.viewDescriptors || styles.length;\n      if (hasReanimated2Props && viewConfig) {\n        adaptViewConfig(viewConfig);\n      }\n\n      this._viewTag = viewTag as number;\n\n      // remove old styles\n      if (prevStyles) {\n        // in most of the cases, views have only a single animated style and it remains unchanged\n        const hasOneSameStyle =\n          styles.length === 1 &&\n          prevStyles.length === 1 &&\n          isSameAnimatedStyle(styles[0], prevStyles[0]);\n\n        if (!hasOneSameStyle) {\n          // otherwise, remove each style that is not present in new styles\n          for (const prevStyle of prevStyles) {\n            const isPresent = styles.some((style) =>\n              isSameAnimatedStyle(style, prevStyle)\n            );\n            if (!isPresent) {\n              prevStyle.viewDescriptors.remove(viewTag);\n            }\n          }\n        }\n      }\n\n      styles.forEach((style) => {\n        style.viewDescriptors.add({\n          tag: viewTag,\n          name: viewName,\n          shadowNodeWrapper,\n        });\n        if (isJest()) {\n          /**\n           * We need to connect Jest's TestObject instance whose contains just props object\n           * with the updateProps() function where we update the properties of the component.\n           * We can't update props object directly because TestObject contains a copy of props - look at render function:\n           * const props = this._filterNonAnimatedProps(this.props);\n           */\n          this.animatedStyle.value = {\n            ...this.animatedStyle.value,\n            ...style.initial.value,\n          };\n          style.animatedStyle.current = this.animatedStyle;\n        }\n      });\n\n      // detach old animatedProps\n      if (\n        prevAnimatedProps &&\n        !isSameAnimatedProps(prevAnimatedProps, this.props.animatedProps)\n      ) {\n        prevAnimatedProps.viewDescriptors!.remove(viewTag as number);\n      }\n\n      // attach animatedProps property\n      if (this.props.animatedProps?.viewDescriptors) {\n        this.props.animatedProps.viewDescriptors.add({\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          tag: viewTag!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          name: viewName!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          shadowNodeWrapper: shadowNodeWrapper!,\n        });\n      }\n    }\n\n    _attachInlineProps() {\n      const newInlineProps: Record<string, any> =\n        extractSharedValuesMapFromProps(this.props);\n      const hasChanged = inlinePropsHasChanged(\n        newInlineProps,\n        this._inlineProps\n      );\n\n      if (hasChanged) {\n        if (!this._inlinePropsViewDescriptors) {\n          this._inlinePropsViewDescriptors = makeViewDescriptorsSet();\n\n          const { viewTag, viewName, shadowNodeWrapper, viewConfig } =\n            this._getViewInfo();\n\n          if (Object.keys(newInlineProps).length && viewConfig) {\n            adaptViewConfig(viewConfig);\n          }\n\n          this._inlinePropsViewDescriptors.add({\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            tag: viewTag!,\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            name: viewName!,\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            shadowNodeWrapper: shadowNodeWrapper!,\n          });\n        }\n        const sharableViewDescriptors =\n          this._inlinePropsViewDescriptors.sharableViewDescriptors;\n\n        const maybeViewRef = NativeReanimatedModule.native\n          ? undefined\n          : ({ items: new Set([this]) } as ViewRefSet<any>); // see makeViewsRefSet\n\n        const updaterFunction = () => {\n          'worklet';\n          const update = getInlinePropsUpdate(newInlineProps);\n          updateProps(sharableViewDescriptors, update, maybeViewRef);\n        };\n        this._inlineProps = newInlineProps;\n        if (this._inlinePropsMapperId) {\n          stopMapper(this._inlinePropsMapperId);\n        }\n        this._inlinePropsMapperId = null;\n        if (Object.keys(newInlineProps).length) {\n          this._inlinePropsMapperId = startMapper(\n            updaterFunction,\n            Object.values(newInlineProps)\n          );\n        }\n      }\n    }\n\n    _detachInlineProps() {\n      if (this._inlinePropsMapperId) {\n        stopMapper(this._inlinePropsMapperId);\n      }\n    }\n\n    componentDidUpdate(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      this._reattachNativeEvents(prevProps);\n      this._attachAnimatedStyles();\n      this._attachInlineProps();\n    }\n\n    _setComponentRef = setAndForwardRef<Component>({\n      getForwardedRef: () =>\n        this.props.forwardedRef as MutableRefObject<\n          Component<Record<string, unknown>, Record<string, unknown>, unknown>\n        >,\n      setLocalRef: (ref) => {\n        // TODO update config\n        const tag = findNodeHandle(ref);\n        const { layout, entering, exiting, sharedTransitionTag } = this.props;\n        if (\n          (layout || entering || exiting || sharedTransitionTag) &&\n          tag != null\n        ) {\n          if (!shouldBeUseWeb()) {\n            enableLayoutAnimations(true, false);\n          }\n          if (layout) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.LAYOUT,\n              maybeBuild(layout)\n            );\n          }\n          if (entering) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.ENTERING,\n              maybeBuild(entering)\n            );\n          }\n          if (exiting) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.EXITING,\n              maybeBuild(exiting)\n            );\n          }\n          if (sharedTransitionTag) {\n            const sharedElementTransition =\n              this.props.sharedTransitionStyle ?? DefaultSharedTransition;\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.SHARED_ELEMENT_TRANSITION,\n              maybeBuild(sharedElementTransition),\n              sharedTransitionTag\n            );\n          }\n        }\n\n        if (ref !== this._component) {\n          this._component = ref;\n        }\n      },\n    });\n\n    _filterNonAnimatedProps(\n      inputProps: AnimatedComponentProps<InitialComponentProps>\n    ): Record<string, unknown> {\n      const props: Record<string, unknown> = {};\n      for (const key in inputProps) {\n        const value = inputProps[key];\n        if (key === 'style') {\n          const styleProp = inputProps.style;\n          const styles = flattenArray<StyleProps>(styleProp ?? []);\n          const processedStyle: StyleProps = styles.map((style) => {\n            if (style && style.viewDescriptors) {\n              // this is how we recognize styles returned by useAnimatedStyle\n              style.viewsRef.add(this);\n              if (this._isFirstRender) {\n                this.initialStyle = {\n                  ...style.initial.value,\n                  ...initialUpdaterRun<StyleProps>(style.initial.updater),\n                };\n              }\n              return this.initialStyle;\n            } else if (hasInlineStyles(style)) {\n              if (this._isFirstRender) {\n                return getInlinePropsUpdate(style);\n              }\n              const newStyle: StyleProps = {};\n              for (const [key, styleValue] of Object.entries(style)) {\n                if (\n                  !isSharedValue(styleValue) &&\n                  !(key === 'transform' && isInlineStyleTransform(styleValue))\n                ) {\n                  newStyle[key] = styleValue;\n                }\n              }\n              return newStyle;\n            } else {\n              return style;\n            }\n          });\n          props[key] = StyleSheet.flatten(processedStyle);\n        } else if (key === 'animatedProps') {\n          const animatedProp = inputProps.animatedProps as Partial<\n            AnimatedComponentProps<AnimatedProps>\n          >;\n          if (animatedProp.initial !== undefined) {\n            Object.keys(animatedProp.initial.value).forEach((key) => {\n              props[key] = animatedProp.initial?.value[key];\n              animatedProp.viewsRef?.add(this);\n            });\n          }\n        } else if (\n          has('current', value) &&\n          value.current instanceof WorkletEventHandler\n        ) {\n          if (value.current.eventNames.length > 0) {\n            value.current.eventNames.forEach((eventName) => {\n              props[eventName] = has('listeners', value.current)\n                ? (value.current.listeners as Record<string, unknown>)[\n                    eventName\n                  ]\n                : dummyListener;\n            });\n          } else {\n            props[key] = dummyListener;\n          }\n        } else if (isSharedValue(value)) {\n          if (this._isFirstRender) {\n            props[key] = (value as SharedValue<any>).value;\n          }\n        } else if (\n          key !== 'onGestureHandlerStateChange' ||\n          !isChromeDebugger()\n        ) {\n          props[key] = value;\n        }\n      }\n      return props;\n    }\n\n    render() {\n      const props = this._filterNonAnimatedProps(this.props);\n      if (isJest()) {\n        props.animatedStyle = this.animatedStyle;\n      }\n\n      if (this._isFirstRender) {\n        this._isFirstRender = false;\n      }\n\n      const platformProps = Platform.select({\n        web: {},\n        default: { collapsable: false },\n      });\n      return (\n        <Component {...props} ref={this._setComponentRef} {...platformProps} />\n      );\n    }\n  }\n\n  AnimatedComponent.displayName = `AnimatedComponent(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n\n  return React.forwardRef<Component>((props, ref) => {\n    return (\n      <AnimatedComponent\n        {...props}\n        {...(ref === null ? null : { forwardedRef: ref })}\n      />\n    );\n  });\n}\n"],"mappings":"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"}